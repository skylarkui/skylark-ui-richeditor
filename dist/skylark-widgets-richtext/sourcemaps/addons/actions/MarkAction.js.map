{"version":3,"sources":["addons/actions/MarkAction.js"],"names":["define","$","addons","Action","i18n","MarkAction","inherit","name","icon","htmlTag","disableTag","_execute","$end","$start","range","this","editor","editable","selection","active","save","unmark","restore","trigger","collapsed","startContainer","endContainer","closest","length","setStartBefore","setEndAfter","mark","util","support","onselectionchange","$contents","$mark","extractContents","find","each","index","ele","replaceWith","html","append","insertNode","commonAncestorContainer","is","parent","actions"],"mappings":";;;;;;;AAAAA,QACE,qBACA,eACA,eACA,cACA,SAASC,EAAEC,EAAOC,EAAOC,GAGzB,IAAIC,EAAaF,EAAOG,SACtBC,KAAO,OAEPC,KAAO,OAEPC,QAAU,OAEVC,WAAa,aAEbC,SAAW,WACT,IAAIC,EAAMC,EAAQC,EAElB,OADAA,EAAQC,KAAKC,OAAOC,SAASC,UAAUJ,QACnCC,KAAKI,QACPJ,KAAKC,OAAOC,SAASC,UAAUE,OAC/BL,KAAKM,OAAOP,GACZC,KAAKC,OAAOC,SAASC,UAAUI,eAC/BP,KAAKC,OAAOO,QAAQ,iBAGlBT,EAAMU,eAAV,GAGAT,KAAKC,OAAOC,SAASC,UAAUE,OAC/BP,EAASZ,EAAEa,EAAMW,gBACjBb,EAAOX,EAAEa,EAAMY,cACXb,EAAOc,QAAQ,QAAQC,QACzBd,EAAMe,eAAehB,EAAOc,QAAQ,QAAQ,IAE1Cf,EAAKe,QAAQ,QAAQC,QACvBd,EAAMgB,YAAYlB,EAAKe,QAAQ,QAAQ,IAEzCZ,KAAKgB,KAAKjB,GACVC,KAAKC,OAAOC,SAASC,UAAUI,UAC/BP,KAAKC,OAAOO,QAAQ,gBAChBR,KAAKC,OAAOC,SAASe,KAAKC,QAAQC,kBAC7BnB,KAAKC,OAAOO,QAAQ,yBAD7B,IAKFQ,KAAO,SAASjB,GACd,IAAIqB,EAAWC,EASf,OARa,MAATtB,IACFA,EAAQC,KAAKC,OAAOC,SAASC,UAAUJ,UAEzCqB,EAAYlC,EAAEa,EAAMuB,oBACVC,KAAK,QAAQC,KAAK,SAASC,EAAOC,GAC1C,OAAOxC,EAAEwC,GAAKC,YAAYzC,EAAEwC,GAAKE,UAEnCP,EAAQnC,EAAE,UAAU2C,OAAOT,GACpBrB,EAAM+B,WAAWT,EAAM,KAGhCf,OAAS,SAASP,GAChB,IAAIsB,EAcJ,OAba,MAATtB,IACFA,EAAQC,KAAKC,OAAOC,SAASC,UAAUJ,SAErCA,EAAMU,WACRY,EAAQnC,EAAEa,EAAMgC,0BACLC,GAAG,UACZX,EAAQA,EAAMY,UAEP/C,EAAEa,EAAMW,gBAAgBE,QAAQ,QAAQC,OACjDQ,EAAQnC,EAAEa,EAAMW,gBAAgBE,QAAQ,QAC/B1B,EAAEa,EAAMY,cAAcC,QAAQ,QAAQC,SAC/CQ,EAAQnC,EAAEa,EAAMY,cAAcC,QAAQ,SAEjCS,EAAMM,YAAYN,EAAMO,WAQnC,OAFAzC,EAAO+C,QAAQlB,KAAO1B,EAEfA","file":"../../../addons/actions/MarkAction.js","sourcesContent":["define([\r\n  \"skylark-domx-query\",\r\n  \"../../addons\",\r\n  \"../../Action\",\r\n  \"../../i18n\"\r\n],function($,addons,Action,i18n){ \r\n\r\n\r\n  var MarkAction = Action.inherit({\r\n    name : 'mark',\r\n\r\n    icon : 'mark',\r\n\r\n    htmlTag : 'mark',\r\n\r\n    disableTag : 'pre, table',\r\n\r\n    _execute : function() {\r\n      var $end, $start, range;\r\n      range = this.editor.editable.selection.range();\r\n      if (this.active) {\r\n        this.editor.editable.selection.save();\r\n        this.unmark(range);\r\n        this.editor.editable.selection.restore();\r\n        this.editor.trigger('valuechanged');\r\n        return;\r\n      }\r\n      if (range.collapsed) {\r\n        return;\r\n      }\r\n      this.editor.editable.selection.save();\r\n      $start = $(range.startContainer);\r\n      $end = $(range.endContainer);\r\n      if ($start.closest('mark').length) {\r\n        range.setStartBefore($start.closest('mark')[0]);\r\n      }\r\n      if ($end.closest('mark').length) {\r\n        range.setEndAfter($end.closest('mark')[0]);\r\n      }\r\n      this.mark(range);\r\n      this.editor.editable.selection.restore();\r\n      this.editor.trigger('valuechanged');\r\n      if (this.editor.editable.util.support.onselectionchange) {\r\n        return this.editor.trigger('selectionchanged');\r\n      }\r\n    },\r\n\r\n    mark : function(range) {\r\n      var $contents, $mark;\r\n      if (range == null) {\r\n        range = this.editor.editable.selection.range();\r\n      }\r\n      $contents = $(range.extractContents());\r\n      $contents.find('mark').each(function(index, ele) {\r\n        return $(ele).replaceWith($(ele).html());\r\n      });\r\n      $mark = $('<mark>').append($contents);\r\n      return range.insertNode($mark[0]);\r\n    },\r\n\r\n    unmark : function(range) {\r\n      var $mark;\r\n      if (range == null) {\r\n        range = this.editor.editable.selection.range();\r\n      }\r\n      if (range.collapsed) {\r\n        $mark = $(range.commonAncestorContainer);\r\n        if (!$mark.is('mark')) {\r\n          $mark = $mark.parent();\r\n        }\r\n      } else if ($(range.startContainer).closest('mark').length) {\r\n        $mark = $(range.startContainer).closest('mark');\r\n      } else if ($(range.endContainer).closest('mark').length) {\r\n        $mark = $(range.endContainer).closest('mark');\r\n      }\r\n      return $mark.replaceWith($mark.html());\r\n    }\r\n\r\n  });\r\n\r\n  \r\n  addons.actions.mark = MarkAction;\r\n\r\n  return MarkAction;\r\n\r\n }); "]}