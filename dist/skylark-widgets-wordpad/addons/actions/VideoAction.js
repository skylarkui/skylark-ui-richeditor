/**
 * skylark-widgets-wordpad - The skylark richeditor widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-wordpad/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-query","../../addons","../../Action","./VideoPopover"],function(e,t,i,r,o){var a=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,d=/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,n=r.inherit({name:"video",icon:"video",htmlTag:"embed, iframe",disableTag:"pre, table, div",videoPlaceholder:"video",videoContainerClass:"video-container",placeholderPoster:"",needFocus:!0,_init:function(){var i;return this.title=this._t(this.name),e.merge(this.editor.editable.formatter._allowedTags,["embed","iframe","video"]),e.extend(this.editor.editable.formatter._allowedAttributes,{embed:["class","width","height","style","type","pluginspage","src","wmode","play","loop","menu","allowscriptaccess","allowfullscreen"],iframe:["class","width","height","style","src","frameborder","data-link","data-width","data-height"],video:["class","width","height","style","poster","controls","allowfullscreen","src","data-link","data-tag"]}),this.placeholderPoster=this.editor.options.addons.actions.video.placeholderPoster,t(document).on("click",".insertVideoBtn",(i=this,function(e){var r;return r={link:t(".video-link").val(),width:t("#video-width").val()||100,height:t("#video-height").val()||100},t(".video-link").val(""),t("#video-width").val(""),t("#video-height").val(""),i._insert(t(".insertVideoBtn").data("videowrap"),r,function(){return i.editor.trigger("valuechanged")})})),this.editor.body.on("click",".wordpad-video-wrapper",function(e){return function(i){var r=t(i.currentTarget).find(".wordpad-video");return e.popover.show(r)}}(this)),this.editor.body.on("mousedown",function(e){return function(){var i;return(i=t(".insertVideoBtn").data("videowrap"))&&i.html()===e.videoPlaceholder&&(i.remove(),t(".insertVideoBtn").data("videowrap",null)),e.popover.hide()}}(this)),this.editor.on("decorate",function(e){return function(i,r){return r.find(".wordpad-video").each(function(i,r){return e.decorate(t(r))})}}(this)),this.editor.on("undecorate",function(e){return function(i,r){return r.find(".wordpad-video").each(function(i,r){return e.undecorate(t(r))})}}(this)),this.popover=new o({action:this}),r.prototype._init.call(this)},decorate:function(e){if(!(e.parent(".wordpad-video-wrapper").length>0))return e.wrap('<figure class="wordpad-video-wrapper"></figure>'),e.parent()},undecorate:function(e){if(e.parent(".wordpad-video-wrapper").length>0)return e.parent().replaceWith(e)},_execute:function(){var e=this._create();return this.popover.show(e)},_status:function(){return this._disableStatus()},_create:function(){var e,i;return this.editor.editable.inputManager.focused||this.editor.focus(),(i=this.editor.editable.selection.range())&&(i.deleteContents(),this.editor.editable.selection.range(i)),e=t("<video/>").attr({poster:this.placeholderPoster,width:225,height:225,class:"wordpad-video"}),i.insertNode(e[0]),this.editor.editable.selection.setRangeAfter(e,i),this.editor.trigger("valuechanged"),this.decorate(e),e},_insert:function(e,i,r){if(i.link){var o=i.link;if(!o.match(/<iframe|<video|<embed/gi)){var n='<iframe style="width: 500px; height: 281px;" src="',s='" frameborder="0" allowfullscreen></iframe>';o.match(a)?o=o.replace(a,n+"https://www.youtube.com/embed/$1"+s):o.match(d)&&(o=o.replace(d,n+"https://player.vimeo.com/video/$2"+s))}var h=t(o).style({width:i.width+"px",height:i.height+"px"}).attr({width:i.width+"px",height:i.height+"px",class:"wordpad-video","data-link":i.link,"data-width":i.width,"data-height":i.height});e.replaceWith(h),e=h}else this._remove(e);return this.editor.trigger("valuechanged"),this.popover.hide(),r(e)},_remove:function(e){e.parent().remove()}});return i.actions.video=n,n});
//# sourceMappingURL=../../sourcemaps/addons/actions/VideoAction.js.map
