{"version":3,"sources":["Popover.js"],"names":["define","langx","$","Wordpad","i18n","Popover","Evented","inherit","init","opts","this","action","editor","_init","prototype","offset","top","left","target","active","_this","el","appendTo","data","render","on","e","addClass","removeClass","_initLabelWidth","$fields","find","length","_labelWidth","each","i","field","$label","Math","max","width","show","$target","position","siblings","popover","hide","refresh","trigger","css","editable","util","reflow","editorOffset","maxLeft","targetH","targetOffset","outerHeight","height","wrapper","outerWidth","min","destroy","off","remove","_t","name","args","arguments","Array","slice","call","translate","apply"],"mappings":"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","file":"../Popover.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-query\",\r\n  \"./Wordpad\",\r\n  \"./i18n\"\r\n],function(langx,$,Wordpad,i18n){ \r\n\r\n  var Popover = langx.Evented.inherit({\r\n     init : function(opts) {\r\n      this.action = opts.action;\r\n      this.editor = opts.action.editor;\r\n      this._init();\r\n    }\r\n  });\r\n\r\n\r\n  Popover.prototype.offset = {\r\n    top: 4,\r\n    left: 0\r\n  };\r\n\r\n  Popover.prototype.target = null;\r\n\r\n  Popover.prototype.active = false;\r\n\r\n  Popover.prototype._init = function() {\r\n    this.el = $('<div class=\"wordpad-popover\"></div>').appendTo(this.editor.el).data('popover', this);\r\n    this.render();\r\n    this.el.on('mouseenter', (function(_this) {\r\n      return function(e) {\r\n        return _this.el.addClass('hover');\r\n      };\r\n    })(this));\r\n    return this.el.on('mouseleave', (function(_this) {\r\n      return function(e) {\r\n        return _this.el.removeClass('hover');\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  Popover.prototype.render = function() {};\r\n\r\n  Popover.prototype._initLabelWidth = function() {\r\n    var $fields;\r\n    $fields = this.el.find('.settings-field');\r\n    if (!($fields.length > 0)) {\r\n      return;\r\n    }\r\n    this._labelWidth = 0;\r\n    $fields.each((function(_this) {\r\n      return function(i, field) {\r\n        var $field, $label;\r\n        $field = $(field);\r\n        $label = $field.find('label');\r\n        if (!($label.length > 0)) {\r\n          return;\r\n        }\r\n        return _this._labelWidth = Math.max(_this._labelWidth, $label.width());\r\n      };\r\n    })(this));\r\n    return $fields.find('label').width(this._labelWidth);\r\n  };\r\n\r\n  Popover.prototype.show = function($target, position) {\r\n    if (position == null) {\r\n      position = 'bottom';\r\n    }\r\n    if ($target == null) {\r\n      return;\r\n    }\r\n    this.el.siblings('.wordpad-popover').each(function(i, popover) {\r\n      popover = $(popover).data('popover');\r\n      if (popover.active) {\r\n        return popover.hide();\r\n      }\r\n    });\r\n    if (this.active && this.target) {\r\n      this.target.removeClass('selected');\r\n    }\r\n    this.target = $target.addClass('selected');\r\n    if (this.active) {\r\n      this.refresh(position);\r\n      return this.trigger('popovershow');\r\n    } else {\r\n      this.active = true;\r\n      this.el.css({\r\n        left: -9999\r\n      }).show();\r\n      if (!this._labelWidth) {\r\n        this._initLabelWidth();\r\n      }\r\n      this.editor.editable.util.reflow();\r\n      this.refresh(position);\r\n      return this.trigger('popovershow');\r\n    }\r\n  };\r\n\r\n  Popover.prototype.hide = function() {\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    if (this.target) {\r\n      this.target.removeClass('selected');\r\n    }\r\n    this.target = null;\r\n    this.active = false;\r\n    this.el.hide();\r\n    return this.trigger('popoverhide');\r\n  };\r\n\r\n  Popover.prototype.refresh = function(position) {\r\n    var editorOffset, left, maxLeft, targetH, targetOffset, top;\r\n    if (position == null) {\r\n      position = 'bottom';\r\n    }\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    editorOffset = this.editor.el.offset();\r\n    targetOffset = this.target.offset();\r\n    targetH = this.target.outerHeight();\r\n    if (position === 'bottom') {\r\n      top = targetOffset.top - editorOffset.top + targetH;\r\n    } else if (position === 'top') {\r\n      top = targetOffset.top - editorOffset.top - this.el.height();\r\n    }\r\n    maxLeft = this.editor.wrapper.width() - this.el.outerWidth() - 10;\r\n    left = Math.min(targetOffset.left - editorOffset.left, maxLeft);\r\n    return this.el.css({\r\n      top: top + this.offset.top,\r\n      left: left + this.offset.left\r\n    });\r\n  };\r\n\r\n  Popover.prototype.destroy = function() {\r\n    this.target = null;\r\n    this.active = false;\r\n    this.editor.off('.linkpopover');\r\n    return this.el.remove();\r\n  };\r\n\r\n  Popover.prototype._t = function(name) {\r\n    var args, ref, result;\r\n    args = 1 <= arguments.length ? Array.prototype.slice.call(arguments, 0) : [];\r\n    result = i18n.translate.apply(i18n, args);\r\n    return result;\r\n  };\r\n\r\n  Wordpad.Popover = Popover;\r\n\r\n  return Popover;\r\n\r\n\t\r\n});"]}