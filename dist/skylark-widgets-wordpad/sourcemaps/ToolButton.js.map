{"version":3,"sources":["ToolButton.js"],"names":["define","langx","$","Widget","i18n","inherit","options","template","menu","menuWrapper","menuItem","separator","_construct","opts","this","action","toolbar","prototype","call","_init","addToolItem","wrapper","_elm","el","find","attr","title","addClass","name","data","setIcon","icon","appendTo","renderMenu","_this","on","e","param","preventDefault","hasClass","toggleClass","siblings","removeClass","is","offset","left","outerWidth","css","right","trigger","command","btn","currentTarget","state","args","updates","undefined","_doActive","value","_doDisabled","iconClassOf","classes","icons","text","render","$menuBtnEl","k","len","ref","ref1","results","isArray","menuEl","length","data-param","push","params","execute","get","tooltip","translate","htmlTag","disableTag","editable","_options","active","disabled","needFocus","shortcut"],"mappings":"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","file":"../ToolButton.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-widgets-base/Widget\",\r\n  \"./i18n\"\r\n],function(langx, $, Widget, i18n){ \r\n  var slice = [].slice;\r\n\r\n  var ToolButton = Widget.inherit( {\r\n\r\n    options : {\r\n      template: '<li><a tabindex=\"-1\" unselectable=\"on\" class=\"toolbar-item\" href=\"javascript:;\"><span></span></a></li>',\r\n\r\n      menu : {\r\n        menuWrapper: '<div class=\"toolbar-menu\"></div>',\r\n        menuItem: '<li><a tabindex=\"-1\" unselectable=\"on\" class=\"menu-item\" href=\"javascript:;\"><span></span></a></li>',\r\n        separator: '<li><span class=\"separator\"></span></li>'      \r\n      }\r\n\r\n    },\r\n\r\n    _construct : function(opts) {\r\n      this.action = opts.action;\r\n      this.toolbar = opts.toolbar;\r\n      //this.editor = opts.toolbar.editor;\r\n      Widget.prototype._construct.call(this,opts);\r\n    },\r\n\r\n    _init : function() {\r\n      var k, len, ref, tag;\r\n      //this.render();\r\n\r\n      //this.wrapper = $(this._tpl.item).appendTo(this.toolbar.list);\r\n      this.toolbar.addToolItem(this);\r\n      this.wrapper = $(this._elm);\r\n\r\n      this.el = this.wrapper.find('a.toolbar-item');\r\n      this.el.attr('title', this.title).addClass(\"toolbar-item-\" + this.name).data('button', this);\r\n      this.setIcon(this.icon);\r\n      if (this.menu) {\r\n          this.menuWrapper = $(this.options.menu.menuWrapper).appendTo(this.wrapper);\r\n          this.menuWrapper.addClass(\"toolbar-menu-\" + this.name);\r\n      \r\n          this.renderMenu();\r\n      }\r\n\r\n      var _this = this;\r\n      this.el.on('mousedown', function(e) {\r\n          var exceed, noFocus, param;\r\n          e.preventDefault();\r\n          //noFocus = _this.needFocus && !_this.editor.editable.inputManager.focused;\r\n          if (_this.el.hasClass('disabled')) {\r\n            return false;\r\n          }\r\n          //if (noFocus) {\r\n          //  _this.editor.focus();\r\n          //}\r\n          if (_this.menu) {\r\n            _this.wrapper.toggleClass('menu-on').siblings('li').removeClass('menu-on');\r\n            if (_this.wrapper.is('.menu-on')) {\r\n              //exceed = _this.menuWrapper.offset().left + _this.menuWrapper.outerWidth() + 5 - _this.editor.wrapper.offset().left - _this.editor.wrapper.outerWidth();\r\n              exceed = _this.menuWrapper.offset().left + _this.menuWrapper.outerWidth() + 5 - _this.toolbar.offset().left - _this.toolbar.outerWidth();\r\n              if (exceed > 0) {\r\n                _this.menuWrapper.css({\r\n                  'left': 'auto',\r\n                  'right': 0\r\n                });\r\n              }\r\n              _this.trigger('menuexpand');\r\n            }\r\n            return false;\r\n          }\r\n          param = _this.el.data('param');\r\n          _this.command(param);\r\n          return false;\r\n      });\r\n      this.wrapper.on('click', 'a.menu-item', function(e) {\r\n          var btn, noFocus, param;\r\n          e.preventDefault();\r\n          btn = $(e.currentTarget);\r\n          _this.wrapper.removeClass('menu-on');\r\n          ///noFocus = _this.needFocus && !_this.editor.editable.inputManager.focused;\r\n          if (btn.hasClass('disabled') || noFocus) {\r\n            return false;\r\n          }\r\n          _this.toolbar.removeClass('menu-on');\r\n          param = btn.data('param');\r\n          _this.command(param);\r\n          return false;\r\n      });\r\n      this.wrapper.on('mousedown', 'a.menu-item', function(e) {\r\n        return false;\r\n      });\r\n\r\n      this.action.state.on(\"changed\", function(e,args) {\r\n        var updates = args.data;\r\n        if (updates[\"active\"] !== undefined) {\r\n          _this._doActive(updates[\"active\"].value);\r\n        }\r\n\r\n        if (updates[\"disabled\"] !== undefined) {\r\n          _this._doDisabled(updates[\"disabled\"].value);\r\n        }\r\n\r\n      });\r\n    },\r\n\r\n    _doActive : function(value) {\r\n      return this.el.toggleClass('active', value);\r\n    },\r\n\r\n    _doDisabled : function(value) {\r\n      return this.el.toggleClass('disabled', value);\r\n    },\r\n\r\n    iconClassOf : function(icon) {\r\n      if (icon) {\r\n        //if (this.editor.options.classes.icons[icon]) {\r\n        //  return this.editor.options.classes.icons[icon];\r\n        if (this.toolbar.options.classes && this.toolbar.options.classes.icons && this.toolbar.options.classes.icons[icon]) {\r\n          return  this.toolbar.options.classes.icons[icon];\r\n        } else {\r\n          return \"wordpad-icon wordpad-icon-\" + icon;\r\n        }\r\n      } else {\r\n        return '';\r\n      }\r\n    },\r\n\r\n    setIcon : function(icon) {\r\n      return this.el.find('span').removeClass().addClass(this.iconClassOf(icon)).text(this.text);\r\n    },\r\n\r\n    render : function() {\r\n\r\n      //this.wrapper = $(this._tpl.item).appendTo(this.toolbar.list);\r\n      this.toolbar.addToolItem(this);\r\n      this.wrapper = $(this._elm);\r\n\r\n      this.el = this.wrapper.find('a.toolbar-item');\r\n      this.el.attr('title', this.title).addClass(\"toolbar-item-\" + this.name).data('button', this);\r\n      this.setIcon(this.icon);\r\n      if (!this.menu) {\r\n        return;\r\n      }\r\n      this.menuWrapper = $(this.options.menu.menuWrapper).appendTo(this.wrapper);\r\n      this.menuWrapper.addClass(\"toolbar-menu-\" + this.name);\r\n      return this.renderMenu();\r\n    },\r\n\r\n    renderMenu : function() {\r\n      var $menuBtnEl, $menuItemEl, k, len, menuItem, ref, ref1, results;\r\n      if (!langx.isArray(this.menu)) {\r\n        return;\r\n      }\r\n      this.menuEl = $('<ul/>').appendTo(this.menuWrapper);\r\n      ref = this.menu;\r\n      results = [];\r\n      for (k = 0, len = ref.length; k < len; k++) {\r\n        menuItem = ref[k];\r\n        if (menuItem === '|') {\r\n          $(this.options.menu.separator).appendTo(this.menuEl);\r\n          continue;\r\n        }\r\n        $menuItemEl = $(this.options.menu.menuItem).appendTo(this.menuEl);\r\n        $menuBtnEl = $menuItemEl.find('a.menu-item').attr({\r\n          'title': (ref1 = menuItem.title) != null ? ref1 : menuItem.text,\r\n          'data-param': menuItem.param\r\n        }).addClass('menu-item-' + menuItem.name);\r\n        if (menuItem.icon) {\r\n          results.push($menuBtnEl.find('span').addClass(this.iconClassOf(menuItem.icon)));\r\n        } else {\r\n          results.push($menuBtnEl.find('span').text(menuItem.text));\r\n        }\r\n      }\r\n      return results;\r\n    },\r\n\r\n    command : function(params) {\r\n      this.action.execute(params);\r\n    },\r\n\r\n    \"name\" : {\r\n      get : function() {\r\n        return this.action.name;\r\n      }\r\n    },\r\n\r\n    \"icon\" : {\r\n      get : function() {\r\n        return this.action.icon;\r\n      }\r\n    },\r\n\r\n    \"title\" : {\r\n      get : function() {\r\n        return this.action.tooltip || i18n.translate(this.action.name);\r\n;\r\n      }\r\n    },\r\n\r\n    \"text\" : {\r\n      get : function() {\r\n        return this.action.text;\r\n      }\r\n    },\r\n\r\n    \"htmlTag\" : {\r\n      get : function() {\r\n        return this.action.htmlTag;\r\n      }\r\n    },\r\n\r\n    \"disableTag\" : {\r\n      get : function() {\r\n        return this.action.disableTag;\r\n      }\r\n    },\r\n\r\n    \"menu\" : {\r\n      get : function() {\r\n        return this.action.menu;\r\n      }\r\n    },\r\n\r\n    \"editable\" : {\r\n      get : function() {\r\n        return this._options.editable;\r\n      }\r\n    },\r\n\r\n    \"active\" : {\r\n      get : function() {\r\n        return this.action.active;\r\n      }\r\n    },\r\n\r\n    \"disabled\" : {\r\n      get : function() {\r\n        return this.action.disabled;\r\n      }\r\n    },\r\n\r\n    \"needFocus\" : {\r\n      get : function() {\r\n        return this.action.needFocus;\r\n      }\r\n    },\r\n\r\n\r\n    \"shortcut\" : {\r\n      get : function() {\r\n        return this.action.shortcut;\r\n      }\r\n    }\r\n\r\n\r\n  }); \r\n\r\n\r\n  return ToolButton;\r\n});\r\n"]}