{"version":3,"sources":["addons/actions/CodeAction.js"],"names":["define","$","addons","Action","CodePopover","CodeAction","inherit","name","icon","htmlTag","disableTag","_init","_this","prototype","call","this","editor","on","e","$el","find","each","i","pre","decorate","undecorate","_checkMode","range","editable","selection","cloneContents","util","blockNodes","join","collapsed","startNodes","filter","length","inlineMode","_status","active","popover","action","show","node","hide","$pre","$code","lang","ref","ref1","attr","match","contents","unwrap","addClass","wrapInner","removeAttr","_execute","_inlineCommand","_blockCommand","blockCode","inlineCode","actions","code"],"mappings":";;;;;;;AAAAA,QACE,qBACA,eACA,eACA,iBACA,SAASC,EAAEC,EAAOC,EAAOC,GAGxB,IAAIC,EAAaF,EAAOG,SACrBC,KAAO,OAEPC,KAAO,OAEPC,QAAU,MAEVC,WAAa,gBAEbC,MAAQ,WAEqB,IAAUC,EAOrC,OARAT,EAAOU,UAAUF,MAAMG,KAAKC,MAC5BA,KAAKC,OAAOC,GAAG,YAAsBL,EAMlCG,KALM,SAASG,EAAGC,GACjB,OAAOA,EAAIC,KAAK,OAAOC,KAAK,SAASC,EAAGC,GACtC,OAAOX,EAAMY,SAASvB,EAAEsB,SAIvBR,KAAKC,OAAOC,GAAG,aAAc,SAAUL,GAC5C,OAAO,SAASM,EAAGC,GACjB,OAAOA,EAAIC,KAAK,OAAOC,KAAK,SAASC,EAAGC,GACtC,OAAOX,EAAMa,WAAWxB,EAAEsB,OAHI,CAMjCR,QAGLW,WAAa,WACX,IAAiBC,EAEjB,OADAA,EAAQZ,KAAKC,OAAOY,SAASC,UAAUF,QACpB1B,EAAE0B,EAAMG,iBAAiBV,KAAKL,KAAKC,OAAOY,SAASG,KAAKC,WAAWC,KAAK,MAAS,GAAMN,EAAMO,WAAmF,IAAtEnB,KAAKC,OAAOY,SAASC,UAAUM,aAAaC,OAAO,QAAQC,QACtLtB,KAAKuB,YAAa,EACXvB,KAAKN,QAAU,QAEtBM,KAAKuB,YAAa,EACXvB,KAAKN,QAAU,SAI1B8B,QAAU,WAGR,GAFAxB,KAAKW,aACLvB,EAAOU,UAAU0B,QAAQzB,KAAKC,OAC1BA,KAAKuB,WAGT,OAAIvB,KAAKyB,QACFzB,KAAK0B,UACR1B,KAAK0B,QAAU,IAAIrC,GACjBsC,OAAQ3B,QAGLA,KAAK0B,QAAQE,KAAK5B,KAAK6B,OAE1B7B,KAAK0B,QACA1B,KAAK0B,QAAQI,YADtB,GAMJrB,SAAW,SAASsB,GAClB,IAAIC,EAAOC,EAAMC,EAAKC,EAEtB,IADAH,EAAQD,EAAK1B,KAAK,WACRiB,OAAS,IACjBW,EAAsC,OAA9BC,EAAMF,EAAMI,KAAK,WAAwD,OAAnCD,EAAOD,EAAIG,MAAM,eAAyBF,EAAK,QAAc,EAC3GH,EAAMM,WAAWC,SACbN,GACF,OAAOF,EAAKK,KAAK,YAAaH,IAKpCvB,WAAa,SAASqB,GACpB,IAAIC,EAAOC,EAMX,OALAA,EAAOF,EAAKK,KAAK,aACjBJ,EAAQ9C,EAAE,WACN+C,IAAkB,IAAVA,GACVD,EAAMQ,SAAS,QAAUP,GAEpBF,EAAKU,UAAUT,GAAOU,WAAW,cAG1CC,SAAW,WACT,OAAI3C,KAAKuB,WACAvB,KAAK4C,iBAEL5C,KAAK6C,iBAIhBA,cAAgB,WACd,OAAO7C,KAAKC,OAAOY,SAASiC,UAAU9C,KAAKN,QAAQM,KAAKL,aAG1DiD,eAAiB,WACf,OAAO5C,KAAKC,OAAOY,SAASkC,WAAW/C,KAAKyB,WAOjD,OAFAtC,EAAO6D,QAAQC,KAAO3D,EAEfA","file":"../../../addons/actions/CodeAction.js","sourcesContent":["define([\r\n  \"skylark-domx-query\",\r\n  \"../../addons\",\r\n  \"../../Action\",\r\n  \"./CodePopover\"\r\n],function($,addons,Action,CodePopover){ \r\n  \r\n\r\n   var CodeAction = Action.inherit({\r\n      name : 'code',\r\n\r\n      icon : 'code',\r\n\r\n      htmlTag : 'pre',\r\n\r\n      disableTag : 'ul, ol, table',\r\n\r\n      _init : function() {\r\n        Action.prototype._init.call(this);\r\n        this.editor.on('decorate', (function(_this) {\r\n          return function(e, $el) {\r\n            return $el.find('pre').each(function(i, pre) {\r\n              return _this.decorate($(pre));\r\n            });\r\n          };\r\n        })(this));\r\n        return this.editor.on('undecorate', (function(_this) {\r\n          return function(e, $el) {\r\n            return $el.find('pre').each(function(i, pre) {\r\n              return _this.undecorate($(pre));\r\n            });\r\n          };\r\n        })(this));\r\n      },\r\n\r\n      _checkMode : function() {\r\n        var $blockNodes, range;\r\n        range = this.editor.editable.selection.range();\r\n        if (($blockNodes = $(range.cloneContents()).find(this.editor.editable.util.blockNodes.join(','))) > 0 || (range.collapsed && this.editor.editable.selection.startNodes().filter('code').length === 0)) {\r\n          this.inlineMode = false;\r\n          return this.htmlTag = 'pre';\r\n        } else {\r\n          this.inlineMode = true;\r\n          return this.htmlTag = 'code';\r\n        }\r\n      },\r\n\r\n      _status : function() {\r\n        this._checkMode();\r\n        Action.prototype._status.call(this);\r\n        if (this.inlineMode) {\r\n          return;\r\n        }\r\n        if (this.active) {\r\n          if (!this.popover) {\r\n            this.popover = new CodePopover({\r\n              action: this\r\n            });\r\n          }\r\n          return this.popover.show(this.node);\r\n        } else {\r\n          if (this.popover) {\r\n            return this.popover.hide();\r\n          }\r\n        }\r\n      },\r\n\r\n      decorate : function($pre) {\r\n        var $code, lang, ref, ref1;\r\n        $code = $pre.find('> code');\r\n        if ($code.length > 0) {\r\n          lang = (ref = $code.attr('class')) != null ? (ref1 = ref.match(/lang-(\\S+)/)) != null ? ref1[1] : void 0 : void 0;\r\n          $code.contents().unwrap();\r\n          if (lang) {\r\n            return $pre.attr('data-lang', lang);\r\n          }\r\n        }\r\n      },\r\n\r\n      undecorate : function($pre) {\r\n        var $code, lang;\r\n        lang = $pre.attr('data-lang');\r\n        $code = $('<code/>');\r\n        if (lang && lang !== -1) {\r\n          $code.addClass('lang-' + lang);\r\n        }\r\n        return $pre.wrapInner($code).removeAttr('data-lang');\r\n      },\r\n\r\n      _execute : function() {\r\n        if (this.inlineMode) {\r\n          return this._inlineCommand();\r\n        } else {\r\n          return this._blockCommand();\r\n        }\r\n      },\r\n\r\n      _blockCommand : function() {\r\n        return this.editor.editable.blockCode(this.htmlTag,this.disableTag);\r\n      },\r\n\r\n      _inlineCommand : function() {\r\n        return this.editor.editable.inlineCode(this.active);\r\n      }\r\n   });\r\n\r\n\r\n   addons.actions.code = CodeAction; \r\n\r\n   return CodeAction;\r\n\r\n});"]}