{"version":3,"sources":["addons/actions/HtmlAction.js"],"names":["define","$","CodeMirror","addons","Action","html","HtmlAction","inherit","name","icon","needFocus","_init","_this","prototype","call","this","editor","textarea","on","e","el","addClass","removeClass","setValue","val","_resizeTextarea","status","_execute","action","i","len","ref","self","blur","toggleClass","htmlMode","hasClass","hidePopover","codemirrorOptions","mode","lineWrapping","dragDrop","autoCloseTags","matchTags","autoCloseBrackets","matchBrackets","indentUnit","indentWithTabs","tabSize","hintOptions","completionSingle","beautify","beautifyFunc","lineNumbers","sync","CodeMirrorEditor","fromTextArea","getValue","_actions","length","setActive","setDisabled","beautifyHTML","arguments","_textareaPadding","innerHeight","height","scrollHeight","actions"],"mappings":";;;;;;;AAAAA,QACE,qBACA,gCACA,eACA,eAQA,uBACA,6CACA,kCACA,kCACA,gDACA,+CACA,SAASC,EAAEC,EAAWC,EAAOC,EAAOC,GACnC,IAIIC,EAAaF,EAAOG,SACvBC,KAAO,OAEPC,KAAO,OAEPC,WAAY,EAEZC,MAAQ,WAE2B,IAAUC,EAW3C,OAZAR,EAAOS,UAAUF,MAAMG,KAAKC,MAC5BA,KAAKC,OAAOC,SAASC,GAAG,SAAmBN,EAIxCG,KAHM,SAASI,GACd,OAAOP,EAAMI,OAAOI,GAAGC,SAAS,SAASC,YAAY,YAGzDP,KAAKC,OAAOC,SAASC,GAAG,OAAQ,SAAUN,GACxC,OAAO,SAASO,GAEd,OADAP,EAAMI,OAAOI,GAAGE,YAAY,SACrBV,EAAMI,OAAOO,SAASX,EAAMI,OAAOC,SAASO,QAHvB,CAK7BT,OACIA,KAAKC,OAAOC,SAASC,GAAG,QAAS,SAAUN,GAChD,OAAO,SAASO,GACd,OAAOP,EAAMa,mBAFuB,CAIrCV,QAGLW,OAAS,aAETC,SAAW,WACT,IAAIC,EAAQC,EAAGC,EAAKC,EAChBC,EAAOjB,KAIX,GAHAA,KAAKC,OAAOiB,OACZlB,KAAKC,OAAOI,GAAGc,YAAY,gBAC3BnB,KAAKC,OAAOmB,SAAWpB,KAAKC,OAAOI,GAAGgB,SAAS,gBAC3CrB,KAAKC,OAAOmB,SAAU,CACxBpB,KAAKC,OAAOqB,cAEZ,IAAKC,GACHC,KAAM,YACNC,cAAc,EACdC,UAAU,EACVC,eAAe,EACfC,WAAW,EACXC,mBAAmB,EACnBC,eAAe,EACfC,WAAY,EACZC,gBAAgB,EAChBC,QAAS,EACTC,aACIC,kBACA,GAEJC,UACE9C,MACE+C,aAAc/C,EAAK8C,WAOzBE,aAAa,GAGdtC,KAAKC,OAAOsC,OACPvC,KAAKwC,kBAMRxC,KAAKwC,iBAAiBhC,SAASR,KAAKC,OAAOC,SAASO,OACpDT,KAAKwC,iBAAiBJ,aANtBpC,KAAKwC,iBAAmBrD,EAAWsD,aAAazC,KAAKC,OAAOC,SAAS,GAAIqB,GACzEvB,KAAKwC,iBAAiBrC,GAAG,OAAO,WAC9Bc,EAAKhB,OAAOO,SAASS,EAAKuB,iBAAiBE,oBAS9C1C,KAAKC,OAAOO,SAASR,KAAKwC,iBAAiBE,YAI7C,IAAK5B,EAAI,EAAGC,GADZC,EAAMhB,KAAKC,OAAO0C,UACIC,OAAQ9B,EAAIC,EAAKD,IAEjB,UADpBD,EAASG,EAAIF,IACFrB,KACToB,EAAOgC,UAAU7C,KAAKC,OAAOmB,UAE7BP,EAAOiC,YAAY9C,KAAKC,OAAOmB,UAGnC,OAAO,MAGT2B,aAAe,WACb,OAAOC,UAAU,IAUnBtC,gBAAkB,WAEhB,OADAV,KAAKiD,mBAAqBjD,KAAKiD,iBAAmBjD,KAAKC,OAAOC,SAASgD,cAAgBlD,KAAKC,OAAOC,SAASiD,UACrGnD,KAAKC,OAAOC,SAASiD,OAAOnD,KAAKC,OAAOC,SAAS,GAAGkD,aAAepD,KAAKiD,qBAQlF,OAFA7D,EAAOiE,QAAQ/D,KAAOC,EAEfA","file":"../../../addons/actions/HtmlAction.js","sourcesContent":["define([\r\n  \"skylark-domx-query\",\r\n  \"skylark-codemirror/CodeMirror\",\r\n  \"../../addons\",\r\n  \"../../Action\",\r\n//  \"skylark-codemirror/addon/fold/foldcode\",\r\n//  \"skylark-codemirror/addon/fold/foldgutter\",\r\n//  \"skylark-codemirror/addon/fold/brace-fold\",\r\n//  \"skylark-codemirror/addon/fold/xml-fold\",\r\n//  \"skylark-codemirror/addon/fold/indent-fold\",\r\n//  \"skylark-codemirror/addon/fold/markdown-fold\",\r\n//  \"skylark-codemirror/addon/fold/comment-fold\",  \r\n  \"skylark-parsers-html\",\r\n  \"skylark-codemirror/addon/beautify/beautify\",  \r\n  \"skylark-codemirror/mode/xml/xml\",\r\n  \"skylark-codemirror/mode/css/css\",\r\n  \"skylark-codemirror/mode/javascript/javascript\",\r\n  \"skylark-codemirror/mode/htmlmixed/htmlmixed\"\r\n],function($,CodeMirror,addons,Action,html){ \r\n   var  hasProp = {}.hasOwnProperty,\r\n        slice = [].slice;\r\n  \r\n\r\n   var HtmlAction = Action.inherit({\r\n    name : 'html',\r\n\r\n    icon : 'html',\r\n\r\n    needFocus : false,\r\n\r\n    _init : function() {\r\n      Action.prototype._init.call(this);\r\n      this.editor.textarea.on('focus', (function(_this) {\r\n        return function(e) {\r\n          return _this.editor.el.addClass('focus').removeClass('error');\r\n        };\r\n      })(this));\r\n      this.editor.textarea.on('blur', (function(_this) {\r\n        return function(e) {\r\n          _this.editor.el.removeClass('focus');\r\n          return _this.editor.setValue(_this.editor.textarea.val());\r\n        };\r\n      })(this));\r\n      return this.editor.textarea.on('input', (function(_this) {\r\n        return function(e) {\r\n          return _this._resizeTextarea();\r\n        };\r\n      })(this));\r\n    },\r\n\r\n    status : function() {},\r\n\r\n    _execute : function() {\r\n      var action, i, len, ref,\r\n          self = this;\r\n      this.editor.blur();\r\n      this.editor.el.toggleClass('wordpad-html');\r\n      this.editor.htmlMode = this.editor.el.hasClass('wordpad-html');\r\n      if (this.editor.htmlMode) {\r\n        this.editor.hidePopover();\r\n        //this.editor.textarea.val(this.beautifyHTML(this.editor.textarea.val()));\r\n        var  codemirrorOptions =  { \r\n          mode: 'htmlmixed', \r\n          lineWrapping: true, \r\n          dragDrop: false, \r\n          autoCloseTags: true, \r\n          matchTags: true, \r\n          autoCloseBrackets: true, \r\n          matchBrackets: true, \r\n          indentUnit: 4, \r\n          indentWithTabs: false, \r\n          tabSize: 4, \r\n          hintOptions: {\r\n              completionSingle:\r\n              false\r\n          },\r\n          beautify : {\r\n            html : {\r\n              beautifyFunc: html.beautify\r\n            }\r\n          },\r\n          \r\n  //        extraKeys: {\"Ctrl-Q\": function(cm){ cm.foldCode(cm.getCursor()); }},\r\n  //        foldGutter: true,\r\n  //        gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\r\n        lineNumbers: true\r\n  \r\n        };\r\n       this.editor.sync(); \r\n       if (!this.CodeMirrorEditor) {\r\n         this.CodeMirrorEditor = CodeMirror.fromTextArea(this.editor.textarea[0], codemirrorOptions);\r\n         this.CodeMirrorEditor.on(\"blur\",function(){\r\n           self.editor.setValue(self.CodeMirrorEditor.getValue());\r\n         })\r\n       } else {\r\n         this.CodeMirrorEditor.setValue(this.editor.textarea.val());\r\n         this.CodeMirrorEditor.beautify();\r\n       }\r\n       //this._resizeTextarea();\r\n\r\n      } else {\r\n        this.editor.setValue(this.CodeMirrorEditor.getValue());\r\n        //this.editor.setValue(this.editor.textarea.val());\r\n      }\r\n      ref = this.editor._actions;\r\n      for (i = 0, len = ref.length; i < len; i++) {\r\n        action = ref[i];\r\n        if (action.name === 'html') {\r\n          action.setActive(this.editor.htmlMode);\r\n        } else {\r\n          action.setDisabled(this.editor.htmlMode);\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n\r\n    beautifyHTML : function() {\r\n      return arguments[0];\r\n      var args;\r\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\r\n      if (beautify.html) {\r\n        return beautify.html.apply(beautify, args);\r\n      } else {\r\n        return beautify.apply(null, args);\r\n      }\r\n    },\r\n\r\n    _resizeTextarea : function() {\r\n      this._textareaPadding || (this._textareaPadding = this.editor.textarea.innerHeight() - this.editor.textarea.height());\r\n      return this.editor.textarea.height(this.editor.textarea[0].scrollHeight - this._textareaPadding);\r\n    }\r\n\r\n   });\r\n\r\n\r\n   addons.actions.html = HtmlAction; \r\n\r\n   return HtmlAction;\r\n});"]}