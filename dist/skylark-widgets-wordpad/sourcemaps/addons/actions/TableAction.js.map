{"version":3,"sources":["addons/actions/TableAction.js"],"names":["define","langx","tables","$","addons","Action","TableAction","inherit","name","icon","htmlTag","disableTag","menu","_init","_this","prototype","call","this","merge","editor","editable","formatter","_allowedTags","extend","_allowedAttributes","td","th","col","_allowedStyles","_initShortcuts","_initResize","on","e","$el","find","each","i","table","decorate","undecorate","$container","range","body","removeClass","selection","containerNode","collapsed","is","setRangeAtEndOf","closest","addClass","keystroke","add","$node","_tdNav","$td","direction","$anotherTr","$tr","action","index","ref","parent","length","eq","resizable","document","cssClasses","resizeHandle","wrapper","hotkeys","editMenu","click","renderMenu","$table","_t","appendTo","menuWrapper","createMenu","createTable","$trs","num","currentTarget","prevAll","addBack","$closestBlock","colNum","rowNum","inputManager","focused","blockNodes","last","util","isEmptyNode","replaceWith","after","setRangeAtStartOf","trigger","tableDecorate","row","phBr","refreshTableWidth","deleteRow","ret","self","newTr","insertRow","deleteCol","newTd","insertCol","deleteTable","$block","_execute","param","actions"],"mappings":"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","file":"../../../addons/actions/TableAction.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-tables\",\r\n  \"skylark-domx-query\",\r\n  \"../../addons\",\r\n  \"../../Action\"\r\n],function(langx,tables,$,addons,Action){ \r\n  var TableAction = Action.inherit({\r\n    name : 'table',\r\n\r\n    icon : 'table',\r\n\r\n    htmlTag : 'table',\r\n\r\n    disableTag : 'pre, li, blockquote',\r\n\r\n    menu : true,\r\n\r\n    _init : function() {\r\n      Action.prototype._init.call(this);\r\n      langx.merge(this.editor.editable.formatter._allowedTags, ['thead', 'th', 'tbody', 'tr', 'td', 'colgroup', 'col']);\r\n      langx.extend(this.editor.editable.formatter._allowedAttributes, {\r\n        td: ['rowspan', 'colspan'],\r\n        th: ['rowspan', 'colspan'],\r\n        col: ['width']\r\n      });\r\n      langx.extend(this.editor.editable.formatter._allowedStyles, {\r\n        td: ['text-align'],\r\n        th: ['text-align']\r\n      });\r\n      this._initShortcuts();\r\n      this._initResize();\r\n      this.editor.on('decorate', (function(_this) {\r\n        return function(e, $el) {\r\n          return $el.find('table').each(function(i, table) {\r\n            return _this.decorate($(table));\r\n          });\r\n        };\r\n      })(this));\r\n      this.editor.on('undecorate', (function(_this) {\r\n        return function(e, $el) {\r\n          return $el.find('table').each(function(i, table) {\r\n            return _this.undecorate($(table));\r\n          });\r\n        };\r\n      })(this));\r\n      this.editor.on('selectionchanged.table', (function(_this) {\r\n        return function(e) {\r\n          var $container, range;\r\n          _this.editor.body.find('.wordpad-table td, .wordpad-table th').removeClass('active');\r\n          range = _this.editor.editable.selection.range();\r\n          if (!range) {\r\n            return;\r\n          }\r\n          $container = _this.editor.editable.selection.containerNode();\r\n          if (range.collapsed && $container.is('.wordpad-table')) {\r\n            _this.editor.editable.selection.setRangeAtEndOf($container);\r\n          }\r\n          return $container.closest('td, th', _this.editor.body).addClass('active');\r\n        };\r\n      })(this));\r\n      this.editor.on('blur.table', (function(_this) {\r\n        return function(e) {\r\n          return _this.editor.body.find('.wordpad-table td, .wordpad-table th').removeClass('active');\r\n        };\r\n      })(this));\r\n      this.editor.editable.keystroke.add('up', 'td', (function(_this) {\r\n        return function(e, $node) {\r\n          _this._tdNav($node, 'up');\r\n          return true;\r\n        };\r\n      })(this));\r\n      this.editor.editable.keystroke.add('up', 'th', (function(_this) {\r\n        return function(e, $node) {\r\n          _this._tdNav($node, 'up');\r\n          return true;\r\n        };\r\n      })(this));\r\n      this.editor.editable.keystroke.add('down', 'td', (function(_this) {\r\n        return function(e, $node) {\r\n          _this._tdNav($node, 'down');\r\n          return true;\r\n        };\r\n      })(this));\r\n      return this.editor.editable.keystroke.add('down', 'th', (function(_this) {\r\n        return function(e, $node) {\r\n          _this._tdNav($node, 'down');\r\n          return true;\r\n        };\r\n      })(this));\r\n    },\r\n\r\n    _tdNav : function($td, direction) {\r\n      var $anotherTr, $tr, action, anotherTag, index, parentTag, ref;\r\n      if (direction == null) {\r\n        direction = 'up';\r\n      }\r\n      action = direction === 'up' ? 'prev' : 'next';\r\n      ref = direction === 'up' ? ['tbody', 'thead'] : ['thead', 'tbody'], parentTag = ref[0], anotherTag = ref[1];\r\n      $tr = $td.parent('tr');\r\n      $anotherTr = this[\"_\" + action + \"Row\"]($tr);\r\n      if (!($anotherTr.length > 0)) {\r\n        return true;\r\n      }\r\n      index = $tr.find('td, th').index($td);\r\n      return this.editor.editable.selection.setRangeAtEndOf($anotherTr.find('td, th').eq(index));\r\n    },\r\n\r\n    _initResize : function() {\r\n\r\n      tables.resizable(document,{\r\n        cssClasses : {\r\n          resizeHandle : \"wordpad-resize-handle\",\r\n          wrapper : \"wordpad-table\"\r\n        }\r\n      });\r\n\r\n    },\r\n\r\n    _initShortcuts : function() {\r\n      this.editor.editable.hotkeys.add('ctrl+alt+up', (function(_this) {\r\n        return function(e) {\r\n          _this.editMenu.find('.menu-item[data-param=insertRowAbove]').click();\r\n          return false;\r\n        };\r\n      })(this));\r\n      this.editor.editable.hotkeys.add('ctrl+alt+down', (function(_this) {\r\n        return function(e) {\r\n          _this.editMenu.find('.menu-item[data-param=insertRowBelow]').click();\r\n          return false;\r\n        };\r\n      })(this));\r\n      this.editor.editable.hotkeys.add('ctrl+alt+left', (function(_this) {\r\n        return function(e) {\r\n          _this.editMenu.find('.menu-item[data-param=insertColLeft]').click();\r\n          return false;\r\n        };\r\n      })(this));\r\n      return this.editor.editable.hotkeys.add('ctrl+alt+right', (function(_this) {\r\n        return function(e) {\r\n          _this.editMenu.find('.menu-item[data-param=insertColRight]').click();\r\n          return false;\r\n        };\r\n      })(this));\r\n    },\r\n\r\n    renderMenu : function() {\r\n      var $table;\r\n      $(\"<div class=\\\"menu-create-table\\\">\\n</div>\\n<div class=\\\"menu-edit-table\\\">\\n  <ul>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteRow\\\">\\n        <span>\" + (this._t('deleteRow')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowAbove\\\">\\n        <span>\" + (this._t('insertRowAbove')) + \" ( Ctrl + Alt + ↑ )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowBelow\\\">\\n        <span>\" + (this._t('insertRowBelow')) + \" ( Ctrl + Alt + ↓ )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteCol\\\">\\n        <span>\" + (this._t('deleteColumn')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColLeft\\\">\\n        <span>\" + (this._t('insertColumnLeft')) + \" ( Ctrl + Alt + ← )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColRight\\\">\\n        <span>\" + (this._t('insertColumnRight')) + \" ( Ctrl + Alt + → )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteTable\\\">\\n        <span>\" + (this._t('deleteTable')) + \"</span>\\n      </a>\\n    </li>\\n  </ul>\\n</div>\").appendTo(this.menuWrapper);\r\n      this.createMenu = this.menuWrapper.find('.menu-create-table');\r\n      this.editMenu = this.menuWrapper.find('.menu-edit-table');\r\n      $table = this.createTable(6, 6).appendTo(this.createMenu);\r\n      this.createMenu.on('mouseenter', 'td, th', (function(_this) {\r\n        return function(e) {\r\n          var $td, $tr, $trs, num;\r\n          _this.createMenu.find('td, th').removeClass('selected');\r\n          $td = $(e.currentTarget);\r\n          $tr = $td.parent();\r\n          num = $tr.find('td, th').index($td) + 1;\r\n          $trs = $tr.prevAll('tr').addBack();\r\n          if ($tr.parent().is('tbody')) {\r\n            $trs = $trs.add($table.find('thead tr'));\r\n          }\r\n          return $trs.find(\"td:lt(\" + num + \"), th:lt(\" + num + \")\").addClass('selected');\r\n        };\r\n      })(this));\r\n      this.createMenu.on('mouseleave', function(e) {\r\n        return $(e.currentTarget).find('td, th').removeClass('selected');\r\n      });\r\n      return this.createMenu.on('mousedown', 'td, th', (function(_this) {\r\n        return function(e) {\r\n          var $closestBlock, $td, $tr, colNum, rowNum;\r\n          _this.wrapper.removeClass('menu-on');\r\n          if (!_this.editor.editable.inputManager.focused) {\r\n            return;\r\n          }\r\n          $td = $(e.currentTarget);\r\n          $tr = $td.parent();\r\n          colNum = $tr.find('td').index($td) + 1;\r\n          rowNum = $tr.prevAll('tr').length + 1;\r\n          if ($tr.parent().is('tbody')) {\r\n            rowNum += 1;\r\n          }\r\n          $table = _this.createTable(rowNum, colNum, true);\r\n          $closestBlock = _this.editor.editable.selection.blockNodes().last();\r\n          if (_this.editor.editable.util.isEmptyNode($closestBlock)) {\r\n            $closestBlock.replaceWith($table);\r\n          } else {\r\n            $closestBlock.after($table);\r\n          }\r\n          _this.decorate($table);\r\n          _this.editor.editable.selection.setRangeAtStartOf($table.find('th:first'));\r\n          _this.editor.trigger('valuechanged');\r\n          return false;\r\n        };\r\n      })(this));\r\n    },\r\n\r\n    decorate : function($table) {\r\n      return $(tables.decorate($table[0],{\r\n        tableDecorate : 'wordpad-table',\r\n        resizeHandle : 'wordpad-resize-handle'\r\n      }));\r\n\r\n    },\r\n\r\n    undecorate : function($table) {\r\n      return $(tables.undecorate($table[0],{\r\n        tableDecorate : 'wordpad-table',\r\n        resizeHandle : 'wordpad-resize-handle'\r\n      }));\r\n\r\n    },\r\n\r\n    createTable : function(row, col, phBr) {\r\n      return $(tables.createTable(row,col,phBr ? this.editor.editable.util.phBr : null));\r\n    },\r\n\r\n    refreshTableWidth : function($table) {\r\n      return table.refreshTableWidth($table[0]);\r\n    },\r\n\r\n    deleteRow : function($td) {\r\n      var self = this,\r\n          ret; \r\n\r\n      tables.deleteRow($td[0],function(newTr,index){\r\n        if (newTr) {\r\n          ret = self.editor.editable.selection.setRangeAtEndOf($(newTr).find('td, th').eq(index));\r\n        }\r\n      })\r\n\r\n      return ret;\r\n    },\r\n\r\n    insertRow : function($td, direction) {\r\n      var self = this,\r\n          ret; \r\n\r\n      tables.insertRow($td[0],direction,self.editor.editable.util.phBr,function(newTr,index){\r\n        ret =  self.editor.editable.selection.setRangeAtStartOf($(newTr).find('td, th').eq(index));\r\n      })\r\n\r\n      return ret;\r\n\r\n    },\r\n\r\n    deleteCol : function($td) {\r\n      var self = this,\r\n          ret; \r\n\r\n      tables.deleteCol($td[0],function(newTd){\r\n        if (newTd) {\r\n          ret = self.editor.editable.selection.setRangeAtEndOf($(newTd));\r\n        }\r\n      })\r\n\r\n      return ret;\r\n    },\r\n\r\n    insertCol : function($td, direction) {\r\n      var self = this,\r\n          ret; \r\n\r\n      tables.insertCol($td[0],direction,self.editor.editable.util.phBr,function(newTd){\r\n        ret = self.editor.editable.selection.setRangeAtStartOf($(newTd));\r\n      })\r\n\r\n      return ret;\r\n    },\r\n\r\n    deleteTable : function($td) {\r\n      var self = this;\r\n      tables.deleteTable($td[0],function($block){\r\n        if ($block.length > 0) {\r\n          return self.editor.editable.selection.setRangeAtStartOf($block);\r\n        }\r\n      });\r\n    },\r\n\r\n    _execute : function(param) {\r\n      var $td;\r\n      $td = this.editor.editable.selection.containerNode().closest('td, th');\r\n      if (!($td.length > 0)) {\r\n        return;\r\n      }\r\n      if (param === 'deleteRow') {\r\n        this.deleteRow($td);\r\n      } else if (param === 'insertRowAbove') {\r\n        this.insertRow($td, 'before');\r\n      } else if (param === 'insertRowBelow') {\r\n        this.insertRow($td);\r\n      } else if (param === 'deleteCol') {\r\n        this.deleteCol($td);\r\n      } else if (param === 'insertColLeft') {\r\n        this.insertCol($td, 'before');\r\n      } else if (param === 'insertColRight') {\r\n        this.insertCol($td);\r\n      } else if (param === 'deleteTable') {\r\n        this.deleteTable($td);\r\n      } else {\r\n        return;\r\n      }\r\n      return this.editor.trigger('valuechanged');\r\n    }\r\n\r\n   });\r\n\r\n\r\n  addons.actions.table = TableAction;\r\n\r\n  return TableAction;\r\n\r\n});"]}