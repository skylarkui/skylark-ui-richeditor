{"version":3,"sources":["addons/toolbar/items/TableButton.js"],"names":["define","langx","$","ToolButton","i18n","addons","TableButton","inherit","_doActive","active","prototype","call","this","createMenu","hide","editMenu","show","renderMenu","$table","_this","editor","action","translate","appendTo","menuWrapper","find","createTable","on","e","$td","$tr","$trs","num","removeClass","currentTarget","parent","index","prevAll","addBack","is","add","addClass","$closestBlock","colNum","rowNum","wrapper","editable","inputManager","focused","length","selection","blockNodes","last","util","isEmptyNode","replaceWith","after","decorate","setRangeAtStartOf","trigger","toolbar","items","table"],"mappings":";;;;;;;AAAAA,QACE,sBACA,qBACA,uCACA,gBACA,mBACA,SAASC,EAAOC,EAAEC,EAAWC,EAAKC,GAElC,IAAIC,EAAcH,EAAWI,SAC3BC,UAAY,SAASC,GAInB,OAFAN,EAAWO,UAAUF,UAAUG,KAAKC,KAAMH,GAEtCA,GACFG,KAAKC,WAAWC,OACTF,KAAKG,SAASC,SAErBJ,KAAKC,WAAWG,OACTJ,KAAKG,SAASD,WAgE3B,OAzDAR,EAAYI,UAAUO,WAAa,WACjC,IAEIC,EAKiDC,EAPjDC,EAASR,KAAKS,OAAOD,OAwBzB,OArBAlB,EAAE,4NAA6OE,EAAKkB,UAAU,aAAgB,iLAA8LlB,EAAKkB,UAAU,kBAAqB,oMAAiNlB,EAAKkB,UAAU,kBAAqB,6OAA4PlB,EAAKkB,UAAU,gBAAmB,gLAA6LlB,EAAKkB,UAAU,oBAAuB,oMAAiNlB,EAAKkB,UAAU,qBAAwB,+OAA8PlB,EAAKkB,UAAU,eAAkB,mDAAmDC,SAASX,KAAKY,aAC9zDZ,KAAKC,WAAaD,KAAKY,YAAYC,KAAK,sBACxCb,KAAKG,SAAWH,KAAKY,YAAYC,KAAK,oBACtCP,EAASN,KAAKS,OAAOK,YAAY,EAAG,GAAGH,SAASX,KAAKC,YACrDD,KAAKC,WAAWc,GAAG,aAAc,UAAoBR,EAalDP,KAZM,SAASgB,GACd,IAAIC,EAAKC,EAAKC,EAAMC,EASpB,OARAb,EAAMN,WAAWY,KAAK,UAAUQ,YAAY,YAG5CD,GADAF,GADAD,EAAM3B,EAAE0B,EAAEM,gBACAC,UACAV,KAAK,UAAUW,MAAMP,GAAO,EACtCE,EAAOD,EAAIO,QAAQ,MAAMC,UACrBR,EAAIK,SAASI,GAAG,WAClBR,EAAOA,EAAKS,IAAItB,EAAOO,KAAK,cAEvBM,EAAKN,KAAK,SAAWO,EAAM,YAAcA,EAAM,KAAKS,SAAS,eAGxE7B,KAAKC,WAAWc,GAAG,aAAc,SAASC,GACxC,OAAO1B,EAAE0B,EAAEM,eAAeT,KAAK,UAAUQ,YAAY,cAEhDrB,KAAKC,WAAWc,GAAG,YAAa,SAAU,SAAUR,GACzD,OAAO,SAASS,GACd,IAAIc,EAAeb,EAAKC,EAAKa,EAAQC,EAErC,GADAzB,EAAM0B,QAAQZ,YAAY,WACrBb,EAAO0B,SAASC,aAAaC,QAoBlC,OAfAL,GADAb,GADAD,EAAM3B,EAAE0B,EAAEM,gBACAC,UACGV,KAAK,MAAMW,MAAMP,GAAO,EACrCe,EAASd,EAAIO,QAAQ,MAAMY,OAAS,EAChCnB,EAAIK,SAASI,GAAG,WAClBK,GAAU,GAEZ1B,EAASC,EAAME,OAAOK,YAAYkB,EAAQD,GAAQ,GAClDD,EAAgBtB,EAAO0B,SAASI,UAAUC,aAAaC,OACnDjC,EAAME,OAAOD,OAAO0B,SAASO,KAAKC,YAAYZ,GAChDA,EAAca,YAAYrC,GAE1BwB,EAAcc,MAAMtC,GAEtBC,EAAME,OAAOoC,SAASvC,GACtBE,EAAO0B,SAASI,UAAUQ,kBAAkBxC,EAAOO,KAAK,aACxDL,EAAOuC,QAAQ,iBACR,GAxBsC,CA0B9C/C,QAILP,EAAOuD,QAAQC,MAAMC,MAAQxD,EAEtBA","file":"../../../../addons/toolbar/items/TableButton.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-widgets-toolbars/ToolbarItem\",\r\n  \"../../../i18n\",\r\n  \"../../../addons\"\r\n],function(langx, $,ToolButton,i18n,addons){ \r\n\r\n  var TableButton = ToolButton.inherit({\r\n    _doActive : function(active) {\r\n\r\n      ToolButton.prototype._doActive.call(this, active);\r\n\r\n      if (active) {\r\n        this.createMenu.hide();\r\n        return this.editMenu.show();\r\n      } else {\r\n        this.createMenu.show();\r\n        return this.editMenu.hide();\r\n      }\r\n\r\n    }\r\n   });\r\n\r\n\r\n  TableButton.prototype.renderMenu = function() {\r\n    var editor = this.action.editor;\r\n\r\n    var $table;\r\n    $(\"<div class=\\\"menu-create-table\\\">\\n</div>\\n<div class=\\\"menu-edit-table\\\">\\n  <ul>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteRow\\\">\\n        <span>\" + (i18n.translate('deleteRow')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowAbove\\\">\\n        <span>\" + (i18n.translate('insertRowAbove')) + \" ( Ctrl + Alt + ↑ )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowBelow\\\">\\n        <span>\" + (i18n.translate('insertRowBelow')) + \" ( Ctrl + Alt + ↓ )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteCol\\\">\\n        <span>\" + (i18n.translate('deleteColumn')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColLeft\\\">\\n        <span>\" + (i18n.translate('insertColumnLeft')) + \" ( Ctrl + Alt + ← )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColRight\\\">\\n        <span>\" + (i18n.translate('insertColumnRight')) + \" ( Ctrl + Alt + → )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteTable\\\">\\n        <span>\" + (i18n.translate('deleteTable')) + \"</span>\\n      </a>\\n    </li>\\n  </ul>\\n</div>\").appendTo(this.menuWrapper);\r\n    this.createMenu = this.menuWrapper.find('.menu-create-table');\r\n    this.editMenu = this.menuWrapper.find('.menu-edit-table');\r\n    $table = this.action.createTable(6, 6).appendTo(this.createMenu);\r\n    this.createMenu.on('mouseenter', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $td, $tr, $trs, num;\r\n        _this.createMenu.find('td, th').removeClass('selected');\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        num = $tr.find('td, th').index($td) + 1;\r\n        $trs = $tr.prevAll('tr').addBack();\r\n        if ($tr.parent().is('tbody')) {\r\n          $trs = $trs.add($table.find('thead tr'));\r\n        }\r\n        return $trs.find(\"td:lt(\" + num + \"), th:lt(\" + num + \")\").addClass('selected');\r\n      };\r\n    })(this));\r\n    this.createMenu.on('mouseleave', function(e) {\r\n      return $(e.currentTarget).find('td, th').removeClass('selected');\r\n    });\r\n    return this.createMenu.on('mousedown', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $closestBlock, $td, $tr, colNum, rowNum;\r\n        _this.wrapper.removeClass('menu-on');\r\n        if (!editor.editable.inputManager.focused) {\r\n          return;\r\n        }\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        colNum = $tr.find('td').index($td) + 1;\r\n        rowNum = $tr.prevAll('tr').length + 1;\r\n        if ($tr.parent().is('tbody')) {\r\n          rowNum += 1;\r\n        }\r\n        $table = _this.action.createTable(rowNum, colNum, true);\r\n        $closestBlock = editor.editable.selection.blockNodes().last();\r\n        if (_this.action.editor.editable.util.isEmptyNode($closestBlock)) {\r\n          $closestBlock.replaceWith($table);\r\n        } else {\r\n          $closestBlock.after($table);\r\n        }\r\n        _this.action.decorate($table);\r\n        editor.editable.selection.setRangeAtStartOf($table.find('th:first'));\r\n        editor.trigger('valuechanged');\r\n        return false;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n\r\n  addons.toolbar.items.table = TableButton;\r\n\r\n  return TableButton;\r\n\r\n\r\n});"]}